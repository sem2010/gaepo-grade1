<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ì¦ë°œê³¼ í™•ì‚° ì‹œë®¬ë ˆì´ì…˜</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f0f0f0; }
    canvas { border: 2px solid #333; margin: 20px auto; display: block; background: #ffffff; }
    .question { margin: 10px 0; }
    .answer { margin-bottom: 20px; width: 80%; }
    button, input[type=range] { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>ğŸŒ¿ ì¦ë°œê³¼ í™•ì‚° ì‹œë®¬ë ˆì´ì…˜</h1>
  
  <div>
    <label for="temperature">ğŸŒ¡ ì˜¨ë„:</label>
    <input type="range" id="temperature" min="0" max="100" value="25" oninput="updateTemperature(this.value)">
    <span id="tempValue">25Â°C</span>
  </div>

  <button onclick="startEvaporation()">ğŸ’§ ì¦ë°œ ì‹œë®¬ë ˆì´ì…˜</button>
  <button onclick="startDiffusion()">ğŸŒ¬ í™•ì‚° ì‹œë®¬ë ˆì´ì…˜</button>

  <canvas id="simCanvas" width="400" height="400"></canvas>
  
  <div id="questionForm" style="display:none;">
    <h2>ì§ˆë¬¸ì— ë‹µí•´ì£¼ì„¸ìš”</h2>
    <div id="questions"></div>
    <input type="text" id="studentName" placeholder="í•™ë²ˆ ì…ë ¥" /><br><br>
    <button onclick="submitAnswers()">ì œì¶œí•˜ê¸°</button>
  </div>

  <script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let animationInterval = null;
    let currentSimulation = "";
    let temperature = 25;

    function updateTemperature(val) {
      temperature = parseInt(val);
      document.getElementById('tempValue').innerText = `${val}K`;
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function drawParticles() {
      clearCanvas();
      ctx.fillStyle = "#cccccc";
      ctx.fillRect(50, 350, 300, 10); // ë°”ë‹¥
      ctx.fillRect(50, 50, 10, 300);  // ì™¼ìª½ ë²½
      ctx.fillRect(340, 50, 10, 300); // ì˜¤ë¥¸ìª½ ë²½
      particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, 2.5, 0, 2 * Math.PI);
        ctx.fillStyle = p.color;
        ctx.fill();
      });
    }

    function startEvaporation() {
      currentSimulation = "ì¦ë°œ ì‹œë®¬ë ˆì´ì…˜";
      showQuestions(currentSimulation);

      particles = [];
      const spacing = 6;
      const startX = 60, endX = 330, startY = 60, endY = 340;

      for (let y = startY; y <= endY; y += spacing) {
        for (let x = startX; x <= endX; x += spacing) {
          particles.push({
            x: x + (Math.random() - 0.5) * 2,
            y: y + (Math.random() - 0.5) * 2,
            vx: (Math.random() - 0.5) * 0.3,
            vy: (Math.random() - 0.5) * 0.3,
            state: 'liquid',
            color: 'blue'
          });
        }
      }
      animateEvaporation();
    }

    function animateEvaporation() {
      if (animationInterval) clearInterval(animationInterval);
      animationInterval = setInterval(() => {
        particles.forEach(p => {
          if (p.state === 'liquid') {
            p.x += p.vx;
            p.y += p.vy;
            if (p.x < 60 || p.x > 330) p.vx *= -1;
            if (p.y < 60 || p.y > 340) p.vy *= -1;
          }
        });

        const surfaceY = Math.min(...particles.filter(p => p.state === 'liquid').map(p => p.y));
        const evaporationRate = temperature / 1000; // ì˜¨ë„ ë¹„ë¡€ í™•ë¥ 
        particles.filter(p => p.state === 'liquid' && Math.abs(p.y - surfaceY) < 3)
          .forEach(p => {
            if (Math.random() < evaporationRate) {
              p.state = 'gas';
              p.vx = (Math.random() - 0.5) * 2;
              p.vy = -Math.random() * 2 - 1;
              p.color = 'lightblue';
            }
          });

        particles.forEach(p => {
          if (p.state === 'gas') {
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.02;
          }
        });

        drawParticles();
      }, 50);
    }

    function startDiffusion() {
      currentSimulation = "í™•ì‚° ì‹œë®¬ë ˆì´ì…˜";
      showQuestions(currentSimulation);

      particles = [];
      for (let i = 0; i < 100; i++) {
        particles.push({
          x: 200 + (Math.random() - 0.5) * 20,
          y: 200 + (Math.random() - 0.5) * 20,
          vx: 0, vy: 0,
          color: 'green'
        });
      }
      animateDiffusion();
    }

    function animateDiffusion() {
      if (animationInterval) clearInterval(animationInterval);
      animationInterval = setInterval(() => {
        const diffusionSpeed = temperature / 50; // ì˜¨ë„ ë¹„ë¡€ í™•ì‚° ì†ë„
        particles.forEach(p => {
          p.vx += (Math.random() - 0.5) * diffusionSpeed;
          p.vy += (Math.random() - 0.5) * diffusionSpeed;
          p.x += p.vx;
          p.y += p.vy;
          p.vx *= 0.95;
          p.vy *= 0.95;
        });
        drawParticles();
      }, 50);
    }

    function showQuestions(simulationType) {
      const questionList = document.getElementById('questions');
      questionList.innerHTML = '';
      const questions = simulationType === 'ì¦ë°œ ì‹œë®¬ë ˆì´ì…˜' ? [
        "1. ì¦ë°œì€ ì–´ë–¤ ì›ë¦¬ë¡œ ì¼ì–´ë‚˜ë‚˜ìš”?",
        "2. ì¦ë°œì€ ì–´ë–¤ ìƒí™©ì—ì„œ ë” ë¹¨ë¦¬ ì¼ì–´ë‚˜ë‚˜ìš”?"
      ] : [
        "1. í™•ì‚°ì€ ì–´ë–¤ ì›ë¦¬ë¡œ ì¼ì–´ë‚˜ë‚˜ìš”?",
        "2. í™•ì‚° ì†ë„ì— ì˜í–¥ì„ ì£¼ëŠ” ìš”ì¸ì€ ë¬´ì—‡ì¸ê°€ìš”?"
      ];
      questions.forEach((q, i) => {
        questionList.innerHTML += `<div class="question">${q}<br>
          <input class="answer" type="text" id="answer${i}" placeholder="ë‹µë³€ ì…ë ¥" /></div>`;
      });
      document.getElementById('questionForm').style.display = 'block';
    }

    function submitAnswers() {
      const name = document.getElementById('studentName').value.trim();
      if (!name) {
        alert("í•™ë²ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const answers = [];
      const questionDivs = document.querySelectorAll('.question');
      questionDivs.forEach((qDiv, i) => {
        answers.push({
          question: qDiv.innerText.split('\n')[0],
          answer: document.getElementById(`answer${i}`).value.trim()
        });
      });
      google.script.run.withSuccessHandler(() => {
        alert("ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
        location.reload();
      }).saveAnswers({
        name: name,
        simulation: currentSimulation,
        answers: answers
      });
    }
  </script>
</body>
</html>
