<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>개포중 1학년부 업무 인수인계</title>
    <!-- Tailwind CSS (Play CDN: 빠른 배포용) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 (UMD, jsDelivr) -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel: 브라우저에서 JSX 변환 (빠른 배포용) -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-slate-50">
    <div id="root"></div>

    <!-- 앱 코드: 브라우저 실행용. Vite 없이 바로 동작 -->
    <script type="text/babel" data-presets="react,env">
      // React 훅을 전역에서 참조
      const { useEffect, useMemo, useRef, useState } = React;

      // 개포중 1학년부 업무 인수인계 웹페이지 — 단일 파일 React 컴포넌트
      // TailwindCSS 기반. 로컬스토리지 저장(개별)
      // 작성 근거: 1) "개포중 1학년부(2025) - 1학년부 업무 정리.pdf" 2) "2025 자유학기 - 쿨메신저.pdf"
      // ⚠️ 학교 상황에 맞게 자유롭게 수정하세요.

      function HandoverPage() {
        // -------------------- 상태 & 유틸 --------------------
        const STORAGE_KEY = "gaepo-grade1-handover-v2"; // v2 스키마(링크 label/url)
        const [tab, setTab] = useState("overview");
        const [query, setQuery] = useState("");

        // 링크 스키마 마이그레이션 유틸
        const normalizeLinks = (linksObj) => {
          const result = {};
          const base = defaultLinks; // {key: {label, url}}
          for (const key of Object.keys(base)) {
            const v = linksObj?.[key];
            if (typeof v === "string") {
              result[key] = { label: base[key].label, url: v };
            } else if (v && typeof v === "object") {
              result[key] = { label: v.label ?? base[key].label, url: v.url ?? "" };
            } else {
              result[key] = { ...base[key] };
            }
          }
          return result;
        };

        const [state, setState] = useState(() => {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return { checks: {}, notes: {}, links: defaultLinks, meta: {} };
            const parsed = JSON.parse(raw);
            return {
              checks: parsed.checks ?? {},
              notes: parsed.notes ?? {},
              links: normalizeLinks(parsed.links ?? {}),
              meta: parsed.meta ?? {},
            };
          } catch (e) {
            return { checks: {}, notes: {}, links: defaultLinks, meta: {} };
          }
        });

        // 변경 시 자동 저장(로컬)
        useEffect(() => {
          try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch {}
        }, [state]);

        // ---- 토스트(안내) 상태 ----
        const [toast, setToast] = useState({ show: false, message: "", variant: "info" });
        const hideTimer = useRef(null);
        const notify = (message, variant = "info", ms = 2200) => {
          if (hideTimer.current) clearTimeout(hideTimer.current);
          setToast({ show: true, message, variant });
          hideTimer.current = setTimeout(() => setToast((s) => ({ ...s, show: false })), ms);
        };

        const toggleCheck = (id) => {
          setState((s) => ({ ...s, checks: { ...s.checks, [id]: !s.checks[id] }, meta: { ...s.meta, updatedAt: new Date().toISOString() } }));
        };

        const updateNote = (id, text) => {
          setState((s) => ({ ...s, notes: { ...s.notes, [id]: text }, meta: { ...s.meta, updatedAt: new Date().toISOString() } }));
        };

        const updateLinkField = (key, field, value) => {
          setState((s) => ({
            ...s,
            links: {
              ...s.links,
              [key]: { ...(s.links?.[key] ?? defaultLinks[key]), [field]: value },
            },
            meta: { ...s.meta, updatedAt: new Date().toISOString() },
          }));
        };

        const resetAll = () => {
          if (confirm("모든 진행표시/메모/링크를 초기화할까요?")) {
            localStorage.removeItem(STORAGE_KEY);
            setState({ checks: {}, notes: {}, links: defaultLinks, meta: {} });
            notify("체크/메모/링크를 초기화했습니다.", "success");
          }
        };

        const exportCSV = () => {
          const rows = [["ID","분류","제목","완료여부","메모"]];
          const pushItem = (item, categoryLabel) => {
            rows.push([
              item.id,
              categoryLabel,
              item.title?.replaceAll("\n"," ") ?? "",
              state.checks[item.id] ? "완료" : "미완료",
              (state.notes[item.id] ?? "").replaceAll("\n"," ")
            ]);
          };
          // 체크리스트 + 가이드 스텝 + 월간 항목을 모두 포함
          Object.entries(checklists).forEach(([cat, list]) => list.forEach(i => pushItem(i, `체크리스트:${cat}`)));
          playbooks.forEach(pb => pb.steps.forEach(st => pushItem(st, `가이드:${pb.title}`)));
          Object.entries(monthlyTasks).forEach(([mon, items]) => items.forEach(i => pushItem(i, `월간:${mon}`)));

          const csv = rows.map(r => r.map(x => `"${(x ?? "").replaceAll('"','""')}"`).join(",")).join("\n");
          const blob = new Blob(["\ufeff" + csv], { type: "text/csv;charset=utf-8;" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          const filename = `1학년부_인수인계_${new Date().toISOString().slice(0,10)}.csv`;
          a.href = url;
          a.download = filename;
          a.click();
          URL.revokeObjectURL(url);
          notify(`CSV를 내려받았습니다: ${filename} (항목 ${rows.length - 1}개)`, "success");
        };

        // 사용자가 직접 저장 버튼을 눌렀을 때: 로컬스토리지 저장 + 안내
        const savePage = () => {
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            notify("현재 페이지가 저장되었습니다.", "success");
          } catch (e) {
            notify("저장 중 문제가 발생했습니다(로컬 저장소).", "error");
          }
        };

        // 검색 인덱스 구성
        const searchIndex = useMemo(() => {
          const bucket = [];
          Object.entries(roles).forEach(([role, items]) => items.forEach((txt, idx) => bucket.push({
            id: `role-${role}-${idx}`,
            where: `역할/${role}`,
            title: txt,
          })));
          Object.entries(monthlyTasks).forEach(([mon, items]) => items.forEach((i) => bucket.push({
            id: i.id,
            where: `월간/${mon}`,
            title: i.title,
          })));
          playbooks.forEach(pb => {
            bucket.push({ id: `pb-${pb.id}`, where: `가이드`, title: pb.title });
            pb.steps.forEach(st => bucket.push({ id: st.id, where: `가이드/${pb.title}`, title: st.title }));
          });
          Object.entries(checklists).forEach(([cat, items]) => items.forEach(i => bucket.push({ id: i.id, where: `체크리스트/${cat}` , title: i.title })));
          templatesData.forEach(cat => {
            bucket.push({ id: `tpl-${cat.id}`, where: `쿨메신저`, title: cat.title });
            cat.items.forEach(t => bucket.push({ id: t.id, where: `쿨메신저/${cat.title}`, title: t.title }));
          });
          return bucket;
        }, []);

        const results = useMemo(() => {
          const q = query.trim();
          if (!q) return [];
          const terms = q.split(/\s+/).map(t => t.toLowerCase());
          return searchIndex.filter(x => terms.every(t => x.title.toLowerCase().includes(t)));
        }, [query, searchIndex]);

        return (
          <div className="min-h-screen bg-slate-50 text-slate-800">
            <div className="sticky top-0 z-30 backdrop-blur bg-white/80 border-b">
              <div className="max-w-7xl mx-auto px-4 py-3 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                <div className="flex items-center gap-3">
                  <span className="inline-flex items-center justify-center w-10 h-10 rounded-2xl bg-indigo-600 text-white text-xl font-bold shadow">1</span>
                  <div>
                    <h1 className="text-xl md:text-2xl font-bold">개포중 1학년부 업무 인수인계 대시보드</h1>
                    <p className="text-sm text-slate-500">업무 흐름 파악 · 월간 타임라인 · 자유학기 가이드 · 체크리스트 · 쿨메신저 템플릿 · 링크 모음</p>
                  </div>
                </div>
                <div className="flex flex-wrap gap-2">
                  <button onClick={savePage} title="현재 상태를 이 브라우저에 저장합니다" className="px-3 py-2 rounded-xl bg-slate-900 text-white text-sm shadow hover:-translate-y-0.5 transition">저장</button>
                  <button onClick={exportCSV} title="체크/메모 현황을 CSV 파일로 다운로드" className="px-3 py-2 rounded-xl bg-indigo-600 text-white text-sm shadow hover:-translate-y-0.5 transition">CSV 내보내기</button>
                  <button onClick={resetAll} title="로컬에 저장된 체크/메모/링크를 모두 지웁니다" className="px-3 py-2 rounded-xl bg-white border text-sm shadow hover:-translate-y-0.5 transition">초기화</button>
                </div>
              </div>
              <div className="max-w-7xl mx-auto px-4 pb-3">
                <div className="flex flex-wrap items-center gap-2">
                  {tabs.map((t) => (
                    <button key={t.key} onClick={() => setTab(t.key)} className={`px-3 py-2 rounded-xl text-sm shadow ${tab===t.key?"bg-indigo-600 text-white":"bg-white border"}`}>{t.label}</button>
                  ))}
                  <div className="flex-1" />
                  <input value={query} onChange={(e)=>setQuery(e.target.value)} placeholder="검색: 예) 통지표, 이수시간, 교복"
                    className="w-full md:w-80 px-3 py-2 rounded-xl border bg-white shadow text-sm"/>
                </div>
                {!!query && (
                  <div className="mt-2 bg-white border rounded-2xl p-3 shadow-sm">
                    <p className="text-xs text-slate-500 mb-2">검색 결과</p>
                    <div className="flex flex-col gap-2 max-h-64 overflow-auto pr-2">
                      {results.length===0 && <span className="text-sm text-slate-500">결과 없음</span>}
                      {results.map((r, i) => (
                        <div key={r.id + i} className="text-sm">
                          <span className="px-2 py-0.5 rounded-full bg-slate-100 border text-slate-600 mr-2">{r.where}</span>
                          <span>{r.title}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>

            <main className="max-w-7xl mx-auto px-4 py-6 grid gap-6">
              {tab === "overview" && <Overview />}
              {tab === "roles" && <Roles />}
              {tab === "timeline" && <Timeline state={state} toggleCheck={toggleCheck} updateNote={updateNote} />}
              {tab === "playbooks" && <Playbooks state={state} toggleCheck={toggleCheck} updateNote={updateNote} />}
              {tab === "checklists" && <Checklists state={state} toggleCheck={toggleCheck} updateNote={updateNote} />}
              {tab === "templates" && <Templates />}
              {tab === "links" && <Links state={state} updateLinkField={updateLinkField} />}
            </main>

            <Toast toast={toast} onClose={() => setToast({ show: false, message: "", variant: "info" })} />

            <footer className="max-w-7xl mx-auto px-4 py-10 text-xs text-slate-500">
              <p>※ 본 페이지는 1학년부 업무 정리 자료 및 자유학기 운영 안내를 바탕으로 구성되었습니다. 실제 상황에 맞게 항목을 추가/수정하세요.</p>
            </footer>
          </div>
        );
      }

      // -------------------- 탭 정의 --------------------
      const tabs = [
        { key: "overview", label: "개요" },
        { key: "roles", label: "역할/담당" },
        { key: "timeline", label: "월간 타임라인" },
        { key: "playbooks", label: "자유학기 가이드" },
        { key: "checklists", label: "인수인계 체크리스트" },
        { key: "templates", label: "쿨메신저 템플릿" },
        { key: "links", label: "링크/서식 모음" },
      ];

      // -------------------- 개요 --------------------
      function Overview() {
        return (
          <section className="grid gap-4">
            <div className="bg-white border rounded-2xl p-5 shadow-sm">
              <h2 className="text-lg font-bold mb-2">무엇을 할 수 있나요?</h2>
              <ul className="list-disc pl-5 space-y-1 text-sm">
                <li>1학년부 전반 업무 흐름을 한 눈에 파악</li>
                <li>월별 핵심 업무(To‑Do) 확인 및 진행상황 체크</li>
                <li>자유학기제 운영 관련 <b>나이스(NICE)</b> 절차를 단계별로 따라가기</li>
                <li>학년말 인수인계를 위한 <b>필수 체크리스트</b>와 메모 기록</li>
                <li>자주 쓰는 링크(드라이브/양식/가정통신문/외부 서비스) 정리</li>
              </ul>
            </div>
            <div className="grid md:grid-cols-3 gap-4">
              <StatCard title="주요 역할" value="부장·기획·생활교육·자유학기·출결·생기부" />
              <StatCard title="핵심 시즌" value="3~7월(자유학기 1학기) · 12~2월(신입생/예산)" />
              <StatCard title="빠른 작업" value="세특 가져오기 · 이수시간등록 · 통지표 인쇄" />
            </div>
            <div className="bg-white border rounded-2xl p-5 shadow-sm">
              <h3 className="font-semibold mb-2">TIP</h3>
              <p className="text-sm text-slate-600">통지표 배부 주간에는 <b>세특/특기사항 가져오기</b>를 담임·교과·자유학기 담당 모두 각 메뉴에서 한 번 더 수행해야 인쇄물에 최신 내용이 반영됩니다.</p>
            </div>
            <RuntimeTests />
          </section>
        );
      }

      function StatCard({ title, value }) {
        return (
          <div className="bg-white border rounded-2xl p-5 shadow-sm">
            <p className="text-xs text-slate-500 mb-1">{title}</p>
            <p className="text-base font-semibold">{value}</p>
          </div>
        );
      }

      // -------------------- 간단 런타임 테스트(개발용) --------------------
      function RuntimeTests() {
        const tests = useMemo(() => {
          const results = [];
          const push = (name, pass, detail = "") => results.push({ name, pass, detail });

          try {
            // 1) tabs에 필수 탭 존재
            const keys = tabs.map(t => t.key);
            push("tabs에 templates/links 포함", keys.includes("templates") && keys.includes("links"));

            // 1-1) 자유학기 가이드로 명칭 변경 확인
            const playbooksTab = (tabs.find(t => t.key === "playbooks") || {}).label;
            push("탭 라벨이 '자유학기 가이드'인지", playbooksTab === "자유학기 가이드");

            // 1-2) 공용 백엔드 탭이 제거되었는지
            push("공용 백엔드 탭 제거됨", !keys.includes("cloud"));

            // 2) monthlyTasks에 '입학준비금' 문구가 더 이상 없음
            const hasBanned = JSON.stringify(monthlyTasks).includes("입학준비금");
            push("월간 타임라인에 입학준비금 문구 없음", !hasBanned);

            // 3) templatesData가 존재하고 항목이 1개 이상
            push("쿨메신저 템플릿 존재", Array.isArray(templatesData) && templatesData.length > 0 && templatesData.some(c => c.items?.length));

            // 4) defaultLinks 구조(label/url) 확인
            const linksOk = Object.values(defaultLinks).every((v) => typeof v.label === "string" && typeof v.url === "string");
            push("기본 링크 객체 구조 정상(label/url)", linksOk);

            // 5) 검색 인덱스가 비어있지 않음 (대략 20개 이상)
            const makeIndexCount = () => {
              let cnt = 0;
              Object.values(roles).forEach((arr) => cnt += arr.length);
              Object.values(monthlyTasks).forEach((arr) => cnt += arr.length);
              playbooks.forEach(pb => cnt += pb.steps.length + 1);
              Object.values(checklists).forEach((arr) => cnt += arr.length);
              templatesData.forEach(cat => { cnt += 1 + (cat.items?.length || 0); });
              return cnt;
            };
            push("검색 인덱스 후보 항목 20개 이상", makeIndexCount() >= 20);

            // 6) 줄바꿈 대체 로직 동작 검증 (빌드 오류 방지용 가드)
            const sample = "a\nb\nc";
            push("\\n 대체가 공백으로 치환됨", sample.replaceAll("\n", " ") === "a b c");

            // 7) 템플릿에 '입학준비금' 문구가 포함되지 않음
            const tplHasBanned = JSON.stringify(templatesData).includes("입학준비금");
            push("쿨메신저 템플릿에 입학준비금 문구 없음", !tplHasBanned);

            // 8) 템플릿 ID가 중복되지 않음
            const allTplIds = new Set();
            let dup = false;
            templatesData.forEach(cat => cat.items.forEach(it => { if (allTplIds.has(it.id)) dup = true; allTplIds.add(it.id); }));
            push("쿨메신저 템플릿 ID 중복 없음", !dup);
          } catch (e) {
            push("테스트 실행 오류", false, String(e));
          }

          return results;
        }, []);

        return (
          <div className="bg-slate-100 border rounded-2xl p-4 text-sm">
            <div className="font-semibold mb-2">🔎 Runtime self-check (개발용)</div>
            <ul className="space-y-1">
              {tests.map((t, i) => (
                <li key={i} className={t.pass ? "text-green-700" : "text-red-700"}>
                  {t.pass ? "✅" : "❌"} {t.name}{t.detail ? ` — ${t.detail}` : ""}
                </li>
              ))}
            </ul>
          </div>
        );
      }

      // -------------------- 역할/담당 --------------------
      const roles = {
        "부장": [
          "부서 총괄, 1학년 순회지도",
        ],
        "기획": [
          "1학년 순회지도(예방활동)",
          "신입생 등록 업무 지원, 입학업무 협조",
          "교복 업무(학교주관구매추진위원회)",
          "진로 및 현장체험활동",
        ],
        "생활교육1": [
          "1학년 순회지도(예방활동)",
          "1학년 생활교육위원회 운영 및 관리(사안조사·보고·추수지도)",
        ],
        "생활교육2": [
          "신입생 등록 업무 지원",
          "1학년 순회지도(예방활동)",
          "명찰·학생증 업무",
          "상벌점 관리 및 추수지도",
        ],
        "자유학기": [
          "신입생 등록 업무 지원",
          "자유학기 운영(계획·만족도·생기부·협의회·출석부)",
          "기초와 적응 프로그램 운영",
          "진로활동 지원",
        ],
        "출결": [
          "출결관리(출석부 관리·점검)",
          "봉사활동 총괄(학생봉사활동추진위원회)",
        ],
        "생활기록부": [
          "1·2학기 생활기록부 점검 총괄",
          "자유학기 관련 업무 지원",
        ],
      };

      function Roles() {
        return (
          <section className="grid gap-4">
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
              {Object.entries(roles).map(([role, items]) => (
                <div key={role} className="bg-white border rounded-2xl p-5 shadow-sm">
                  <div className="flex items-center gap-2 mb-2">
                    <span className="w-2 h-2 rounded-full bg-indigo-600" />
                    <h3 className="font-semibold">{role}</h3>
                  </div>
                  <ul className="list-disc pl-5 text-sm space-y-1">
                    {items.map((it, idx) => <li key={idx}>{it}</li>)}
                  </ul>
                </div>
              ))}
            </div>
          </section>
        );
      }

      // -------------------- 월간 타임라인 --------------------
      const monthlyTasks = {
        "3월": [
          { id: "m3-01", title: "민원 대응 방법 안내·학급 규칙 유의점 공유(학칙·학생생활지도 고시 범위 내)" },
          { id: "m3-02", title: "학운위 심의(수익자부담금/명찰 CMS 출금 등)" },
          { id: "m3-03", title: "자유학기 운영계획서 최종 제출·학습준비물/출석부 파일 준비" },
          { id: "m3-04", title: "교복 상한가 안내·업무 지침서 공문 접수" },
          { id: "m3-05", title: "현장체험학습 계획 수립·가정통신문 발송" },
          { id: "m3-06", title: "생활교육 소위원회 개최·순시 및 학생지도" },
          { id: "m3-07", title: "명찰 안내·CMS 관련 가정통신문, 지출 품의·정산 게시" },
          { id: "m3-08", title: "티머니 학생증 제작/지급 안내·신청서 내부기안·재발급 안내" },
          { id: "m3-10", title: "자유학기 수강신청 프로그램 이용비 납부 및 안내 가정통신문" },
          { id: "m3-11", title: "업무 참고 자료·견적서 정리(드라이브)" },
          { id: "m3-12", title: "학사·봉사교육 일정 확인, 매월 출결 점검" },
        ],
        "4월": [
          { id: "m4-01", title: "학운위 심의(정산 보고·현장체험·교복·주민참여예산·탄소중립)" },
          { id: "m4-02", title: "교복 주관구매추진위 운영(디자인 확정·견적·기초금액·계획)" },
          { id: "m4-03", title: "교복(하복)·현장체험 가정통신문 발송" },
          { id: "m4-04", title: "상벌점 모니터링·지도(봉사/청소/캠페인)" },
          { id: "m4-06", title: "자유학기 3·4기 수강신청 안내 가정통신문" },
        ],
        "5월": [
          { id: "m5-01", title: "학운위 심의(학부모 경비 부담·현장체험 정산)" },
          { id: "m5-02", title: "교복 주관구매 만족도 조사 가정통신문" },
          { id: "m5-03", title: "자유학기 1·2기 학생 개별 피드백 결과 보고" },
        ],
        "6월": [
          { id: "m6-01", title: "차년도 교복 주관구매 사전협의·추진위 구성·의견수렴" },
          { id: "m6-02", title: "교복 관련 현황 제출·회의 결과 보고" },
          { id: "m6-03", title: "자유학기 생활기록부 기재 안내 연수" },
        ],
        "7월": [
          { id: "m7-01", title: "자유학기 운영평가 협의회" },
          { id: "m7-02", title: "1학기말 생활기록부 점검 안내 및 점검" },
        ],
        "8월": [
          { id: "m8-01", title: "교복 업체 선정 완료(목표)" },
          { id: "m8-02", title: "자유학기 만족도 조사(온라인) 안내" },
        ],
        "12월": [
          { id: "m12-02", title: "2학기말 생활기록부 점검 안내 및 점검" },
        ],
        "1월": [
          { id: "m1-01", title: "신입생 개인정보 수집·이용 및 제3자 제공 동의(명찰·교복·현장체험·에듀테크 등)" },
          { id: "m1-02", title: "신입생 학교배정·교복 구매 안내/홍보 및 홈페이지 게시" },
          { id: "m1-03", title: "차년도 교복 주관구매 안내 가정통신문(구매방법 등)" },
          { id: "m1-04", title: "구매 인원 확정·치수 측정" },
          { id: "m1-07", title: "차년도 자유학기 주제선택 수요조사 가정통지문" },
        ],
        "2월": [
          { id: "m2-01", title: "당해 자유학기 예산 집행결과 제출" },
          { id: "m2-02", title: "차년도 자유학기 운영계획 제출" },
        ],
      };

      function Timeline({ state, toggleCheck, updateNote }) {
        const months = Object.keys(monthlyTasks);
        return (
          <section className="grid gap-4">
            {months.map((mon) => (
              <div key={mon} className="bg-white border rounded-2xl p-5 shadow-sm">
                <div className="flex items-center justify-between mb-3">
                  <h3 className="font-semibold">{mon}</h3>
                  <span className="text-xs text-slate-500">핵심 업무</span>
                </div>
                <div className="grid md:grid-cols-2 gap-3">
                  {monthlyTasks[mon].map((item) => (
                    <TaskRow key={item.id} item={item} state={state} toggleCheck={toggleCheck} updateNote={updateNote} />
                  ))}
                </div>
              </div>
            ))}
          </section>
        );
      }

      function TaskRow({ item, state, toggleCheck, updateNote }) {
        const checked = !!state.checks[item.id];
        return (
          <div className={`rounded-xl border p-3 shadow-sm ${checked?"bg-green-50 border-green-200":"bg-white"}`}>
            <div className="flex items-start gap-2">
              <input type="checkbox" checked={checked} onChange={() => toggleCheck(item.id)} className="mt-1 w-4 h-4" />
              <div className="flex-1">
                <p className="text-sm font-medium leading-5">{item.title}</p>
                <textarea value={state.notes[item.id] ?? ""} onChange={(e)=>updateNote(item.id, e.target.value)}
                  placeholder="메모" className="mt-2 w-full text-sm border rounded-lg p-2 bg-white/70" rows={2} />
              </div>
            </div>
          </div>
        );
      }

      // -------------------- 자유학기 가이드 --------------------
      const playbooks = [
        {
          id: "pb-assign",
          title: "[초기] 수강신청·학생배정·수업장소 안내",
          steps: [
            { id: "pb-assign-01", title: "가정통신문 발송: 수강신청 기간·방법 안내, e알리미/가정통신문 병행" },
            { id: "pb-assign-02", title: "계정/비밀번호 이슈 지원: 신청 전 로그인 테스트·초기 비밀번호 재설정" },
            { id: "pb-assign-03", title: "학생배정(나이스): [학급담임→자유학기→활동관리] / 영역=주제선택(1·2기, 3·4기)" },
            { id: "pb-assign-04", title: "수업장소 안내문 교실 배포·출석부 책자/파일 배부(기초·적응은 분반 전, 정규 시작 수업부터 출석)" },
          ]
        },
        {
          id: "pb-hours",
          title: "[진행] 이수시간 기준등록·출결 반영",
          steps: [
            { id: "pb-hours-01", title: "이수시간 기준등록(나이스): [자유학기담임→자유학기활동관리→이수시간기준등록] (기별 수업일 변동 반영)" },
            { id: "pb-hours-02", title: "출결 입력 마감: 주제선택·진로탐색 출결을 해당 기말까지 반영" },
            { id: "pb-hours-03", title: "교과(1학기) 이수처리: [교과담임→성적처리→자유학기성적관리] 전체등록(정원 외 제외)" },
          ]
        },
        {
          id: "pb-remarks",
          title: "[기말] 특기사항 작성·검토·가져오기",
          steps: [
            { id: "pb-remarks-01", title: "특기사항 작성(나이스): [자유학기담임→활동관리→학생부자료기록] 진로탐색·주제선택 작성(수업당 750byte 권장)" },
            { id: "pb-remarks-02", title: "출력물 제출: 출력버튼(HWP 저장 포함) → 담당자 제출(오탈자 점검)" },
            { id: "pb-remarks-03", title: "문자열 일괄수정: 통지표 전 나이스 '문자열바꾸기'로 오탈자 신속 수정" },
            { id: "pb-remarks-04", title: "가져오기 필수: [학교생활통지표관리]에서 '자유학기 학생생활 특기사항 가져오기' 수행(담임·교과·자유학기 모두)" },
          ]
        },
        {
          id: "pb-report",
          title: "[배부] 성적통지표 옵션·인쇄·배부",
          steps: [
            { id: "pb-report-01", title: "담임 사전점검: 우리반 학생 전원 미리보기로 교과10·진로2·주선4 입력 여부 확인" },
            { id: "pb-report-02", title: "인쇄 옵션: 가정통신문·과목별 서술평가 제외 체크(예시 옵션 준용), 수업일수 확인" },
            { id: "pb-report-03", title: "전용용지/도장 준비 후 인쇄·조회/종례 배부" },
          ]
        },
        {
          id: "pb-wrap",
          title: "[마무리] 출석부 회수·이수시간 저장·만족도/평가",
          steps: [
            { id: "pb-wrap-01", title: "연두색 출석부 회수(기별 장수 확인)" },
            { id: "pb-wrap-02", title: "이수시간 기준일=학기종료일 설정 후 저장" },
            { id: "pb-wrap-03", title: "만족도 조사 실시 및 운영평가 협의회" },
          ]
        },
      ];

      function Playbooks({ state, toggleCheck, updateNote }) {
        return (
          <section className="grid gap-4">
            {playbooks.map(pb => (
              <div key={pb.id} className="bg-white border rounded-2xl p-5 shadow-sm">
                <h3 className="font-semibold mb-3">{pb.title}</h3>
                <div className="grid md:grid-cols-2 gap-3">
                  {pb.steps.map(st => (
                    <TaskRow key={st.id} item={st} state={state} toggleCheck={toggleCheck} updateNote={updateNote} />
                  ))}
                </div>
              </div>
            ))}
            <div className="bg-indigo-50 border-indigo-200 border rounded-2xl p-4 text-sm text-slate-700">
              <b>메모:</b> 통지표 주간에는 <u>담임·교과·자유학기 담당</u> 모두 각 메뉴에서 <b>세특/특기사항 가져오기</b>를 재실행해야 최신 내용이 반영됩니다.
            </div>
          </section>
        );
      }

      // -------------------- 업무별 체크리스트 --------------------
      const checklists = {
        "자유학기": [
          { id: "cl-free-01", title: "자유학기 운영계획서·수업일정 확정(1~4기)" },
          { id: "cl-free-02", title: "수강신청 안내·계정 이슈 대응·수업장소 안내" },
          { id: "cl-free-03", title: "출석부(파일·책자) 배부/회수" },
          { id: "cl-free-04", title: "이수시간 기준등록·출결 마감" },
          { id: "cl-free-05", title: "특기사항 작성·출력(HWP 저장)·오탈자 수정·가져오기" },
          { id: "cl-free-06", title: "성적통지표 옵션·인쇄·배부" },
          { id: "cl-free-07", title: "운영평가·만족도 조사·예산 집행 결과 정리" },
        ],
        "생활기록부": [
          { id: "cl-sae-01", title: "1·2학기 점검 계획 수립(담임/교과 역할 분장)" },
          { id: "cl-sae-02", title: "세특 기준·표기 원칙 공유(글자수, 금지어 등)" },
          { id: "cl-sae-03", title: "점검용 인쇄물 수합·오탈자 수정 프로세스 운영" },
        ],
        "출결·봉사": [
          { id: "cl-att-01", title: "월별 출결 점검 캘린더·마감일 공유" },
          { id: "cl-att-02", title: "봉사활동 추진위원회 운영·안내" },
        ],
        "생활교육": [
          { id: "cl-life-01", title: "상벌점 모니터링·지도의 날 운영(청소/캠페인 등)" },
          { id: "cl-life-02", title: "사안 발생 시 조사·보고·추수지도 절차 점검" },
        ],
        "교복": [
          { id: "cl-uniform-01", title: "학교주관구매추진위 구성·디자인·견적·기초금액" },
          { id: "cl-uniform-02", title: "상한가·사양·품질·시장가·비교견적 검토" },
          { id: "cl-uniform-03", title: "만족도 조사·업체 선정·현황 보고" },
        ],
        "명찰·학생증": [
          { id: "cl-id-01", title: "명찰 CMS·정산·홈페이지 게시" },
          { id: "cl-id-02", title: "티머니 학생증 제작·배부·재발급 안내" },
        ],
        "현장체험·진로": [
          { id: "cl-trip-01", title: "학운위 심의(계획·정산) 및 가정통신문" },
          { id: "cl-trip-02", title: "안전계획·CMS 출금·참여여부 조사" },
        ],
        "신입생·예산": [
          { id: "cl-new-01", title: "개인정보 동의(명찰·교복·현장체험·에듀테크 등)" },
          { id: "cl-new-02", title: "배정·교복 구매·치수 측정·안내 게시" },
        ],
      };

      function Checklists({ state, toggleCheck, updateNote }) {
        return (
          <section className="grid gap-4">
            {Object.entries(checklists).map(([cat, items]) => (
              <div key={cat} className="bg-white border rounded-2xl p-5 shadow-sm">
                <h3 className="font-semibold mb-3">{cat}</h3>
                <div className="grid md:grid-cols-2 gap-3">
                  {items.map((i) => (
                    <TaskRow key={i.id} item={i} state={state} toggleCheck={toggleCheck} updateNote={updateNote} />
                  ))}
                </div>
              </div>
            ))}
          </section>
        );
      }

      // -------------------- 링크/서식 모음 --------------------
      const defaultLinks = {
        drive: { label: "공유 드라이브 폴더(업무 참고자료/견적서)", url: "" },
        dbdb: { label: "디비디비스쿨(수강신청/세특 보조)", url: "https://www.dbdbschool.kr" },
        canva: { label: "Canva 동영상/안내자료", url: "https://www.canva.com" },
        nice_free: { label: "나이스: 자유학기 활동관리(이수시간/학생부기록)", url: "" },
        nice_report: { label: "나이스: 학교생활통지표관리", url: "" },
        sheet_attendance: { label: "자유학기 출석부(스프레드시트)", url: "" },
        form_templates: { label: "가정통신문·양식 템플릿", url: "" },
      };

      function Links({ state, updateLinkField }) {
        const keys = Object.keys(defaultLinks);
        return (
          <section className="bg-white border rounded-2xl p-5 shadow-sm">
            <h3 className="font-semibold mb-3">자주 쓰는 링크</h3>
            <div className="grid md:grid-cols-2 gap-3">
              {keys.map((key) => (
                <div key={key} className="flex flex-col gap-2 border rounded-xl p-3">
                  <div className="flex items-center gap-2">
                    <div className="w-24 shrink-0 text-xs text-slate-500">제목</div>
                    <input value={state.links?.[key]?.label ?? defaultLinks[key].label}
                      onChange={(e)=>updateLinkField(key, "label", e.target.value)}
                      placeholder="표시할 제목" className="flex-1 px-3 py-2 rounded-xl border bg-white shadow text-sm" />
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-24 shrink-0 text-xs text-slate-500">링크</div>
                    <input value={state.links?.[key]?.url ?? ""}
                      onChange={(e)=>updateLinkField(key, "url", e.target.value)}
                      placeholder="https://" className="flex-1 px-3 py-2 rounded-xl border bg-white shadow text-sm" />
                  </div>
                </div>
              ))}
            </div>
            <p className="text-xs text-slate-500 mt-3">※ 제목과 링크는 이 브라우저의 로컬에만 저장됩니다.</p>
          </section>
        );
      }

      // -------------------- 쿨메신저 템플릿(더 많은 내용은 구글시트 참조) --------------------
      const templatesData = [
        {
          id: "tpl-attendance",
          title: "출석부·수업장소 안내",
          items: [
            { id: "tpl-01", title: "주제선택 2기 첫 수업 출석부 수령 안내",
              body: `안녕하세요? 오늘 자유학기제 {기수}(요일) 첫 수업이 시작됩니다.\n주제선택 {기수} 담당 선생님께서는 6교시 시작 전에 잠시 1학년부 원형탁자로 오셔서 출석부를 가져가 주시고, 해당 교실로 입실해 주세요.\n*출석부는 {기수}가 끝나면 회수 예정입니다. 매주 출석부로 출석체크 부탁드립니다.` },
            { id: "tpl-02", title: "기초·적응 시간 출석 체크 안내",
              body: `안녕하세요, 선생님.\n기초와 적응 시간에는 아직 분반 전이라 출석체크가 어렵습니다.\n정규 수업(주제선택/진로) 시작 시점부터 출석부로 출석을 체크해 주세요.` },
            { id: "tpl-03", title: "출석부 파일/책자 배부 안내",
              body: `안녕하세요, 선생님!\n자유학기제 출석부 파일을 공유드리며, 1학년부 탁상에 출석부 책자도 비치해 두었습니다.\n수업 들어가시기 전 챙겨가 주시면 감사하겠습니다.\n[첨부] 출석부 폼/파일` },
          ]
        },
        {
          id: "tpl-apply",
          title: "수강신청·일정 안내",
          items: [
            { id: "tpl-04", title: "3·4기 수강신청(가정통신문 발송 후)",
              body: `안녕하세요. 1학년부 자유학기 관련 안내입니다.\ne알리미로 자유학기 {기수} 수강신청 안내 가정통신문이 발송되었습니다.\n수강신청 기간: {시작일시} ~ {종료일시}\n(현장·진로체험 일정이 포함되어 있으니 학생들에게 기간 엄수 안내 부탁드립니다.)` },
            { id: "tpl-05", title: "기수 전환 일정 안내",
              body: `자유학기 수업 일정 안내드립니다.\n{1기요일} 1기 마지막 수업: {1기종료일}\n{2기요일} 2기 마지막 수업: {2기종료일}\n{3기요일} 3기 첫 수업: {3기시작일}\n{4기요일} 4기 첫 수업: {4기시작일}` },
          ]
        },
        {
          id: "tpl-remarks",
          title: "특기사항·나이스 작업",
          items: [
            { id: "tpl-06", title: "특기사항 작성·출력물 제출(주제선택 담당)",
              body: `안녕하세요, 선생님~ 자유학기 안내드립니다.\n학생들의 자유학기 특기사항 작성이 완료되면 출력물을 임승미 선생님께 제출해 주세요. (출력물 안내 하단 참고)\n통지표 배부 전 맞춤법 등 오탈자 점검이 필요하여 기한 내 제출 부탁드립니다.\n<하실 일>\n① [나이스]-[자유학기담임]-[이수시간 기준등록]에서 이수시간 확인\n② [자유학기담임]-[자유학기 활동관리]-[학생부자료기록]에서 특기사항 작성\n③ [자유학기담임]-[자유학기 학교생활통지표관리]-[자유학기 활동영역별 특기사항]에서 '자유학기 학생생활 특기사항 가져오기' 클릭\n④ [자유학기담임]-[자유학기 활동관리]-[학생부자료기록]에서 '출력' 클릭 후 출력물 제출` },
            { id: "tpl-07", title: "오탈자 수정 후 '가져오기' 재실행 안내",
              body: `★ 나이스에서 특기사항 수정하신 뒤에는 반드시 통지표 '가져오기'도 다시 해 주세요!\n경로: [자유학기담임]-[자유학기 학교생활통지표관리]-[자유학기 활동영역별 특기사항]-[자유학기 학생생활 특기사항 가져오기] 클릭 (학생 전체 체크 후 반영)` },
            { id: "tpl-08", title: "담임용 통지표 인쇄·배부 협조",
              body: `안녕하세요. 1학년 담임선생님들께 안내드립니다.\n이번 주 {배부예정일}에 자유학기 성적통지표가 배부될 예정입니다.\n점검이 마무리되면 미리 알려 드리겠습니다. 각 반 학생들의 통지표를 인쇄하신 뒤 종례 시간에 배부해 주세요.` },
            { id: "tpl-09", title: "통지표 옵션 설정 안내(자유학기만 표시)",
              body: `[나이스]-[학급담임]-[자유학기 학교생활통지표관리]에서 '조회' 후 옵션을 다음과 같이 설정해 주세요.\n- '자유학기 활동영역별 특기사항 제외' 체크 해제(X)\n- '과목별 학습영역' 체크 해제(X)\n- 그 외 옵션은 모두 제외 체크(O)\n'미리보기' 시 자유학기 활동만 표시되어야 정상입니다.` },
          ]
        },
        {
          id: "tpl-supplies",
          title: "물품·학습준비",
          items: [
            { id: "tpl-10", title: "자유학기 물품 구입 신청 마감",
              body: `안녕하세요. 자유학기 물품 구입 신청을 오늘 마감합니다.\n학습준비물 구매가 필요한 선생님들께서는 {마감일시}까지 신청 부탁드립니다.\n[링크] 2025 자유학기 - Google Sheets` },
            { id: "tpl-11", title: "기초·적응 시간 임장 안내",
              body: `오늘 6-7교시는 자유학기 기초와 적응 시간입니다.\n목요일 자유학기 담당 선생님께서는 첨부된 교실표를 확인하시고 각 교실로 임장 부탁드립니다.\n(컴시간알리미 교실 배정과 다를 수 있으니 첨부를 확인해 주세요.)` },
          ]
        },
      ];

      function Templates() {
        const [filter, setFilter] = useState("");
        const all = useMemo(() => templatesData.flatMap(c => c.items.map(it => ({...it, category: c.title}))), []);
        const list = useMemo(() => {
          const q = filter.trim().toLowerCase();
          if (!q) return all;
          return all.filter(t => t.title.toLowerCase().includes(q) || t.body.toLowerCase().includes(q));
        }, [filter, all]);

        const copy = async (text) => {
          try { await navigator.clipboard.writeText(text); alert("복사되었습니다!"); }
          catch { prompt("복사에 실패했습니다. Ctrl+C로 복사하세요:", text); }
        };

        return (
          <section className="grid gap-4">
            <div className="bg-white border rounded-2xl p-4 shadow-sm">
              <div className="flex items-center gap-2">
                <input value={filter} onChange={(e)=>setFilter(e.target.value)} placeholder="검색: 예) 출석부, 특기사항, 가져오기"
                  className="flex-1 px-3 py-2 rounded-xl border bg-white shadow text-sm" />
              </div>
            </div>
            <div className="grid md:grid-cols-2 gap-4">
              {list.map(t => (
                <div key={t.id} className="bg-white border rounded-2xl p-4 shadow-sm">
                  <div className="flex items-center justify-between mb-2">
                    <div className="text-sm font-semibold">{t.title}</div>
                    <span className="text-xs text-slate-500">{t.category}</span>
                  </div>
                  <textarea className="w-full text-sm border rounded-lg p-2 bg-white/70" rows={6} defaultValue={t.body} />
                  <div className="mt-2 flex justify-end">
                    <button onClick={()=>copy(t.body)} className="px-3 py-2 rounded-xl bg-indigo-600 text-white text-xs shadow">복사</button>
                  </div>
                </div>
              ))}
            </div>
            <p className="text-xs text-slate-500">※ {`{기수}`},{`{배부예정일}`},{`{시작일시}`},{`{종료일시}`} 등은 발송 전 알맞게 바꿔 주세요.</p>
          </section>
        );
      }

      // -------------------- 공용 토스트 컴포넌트 --------------------
      function Toast({ toast, onClose }) {
        const base = "fixed inset-x-0 bottom-4 mx-auto w-fit max-w-[90%]";
        const color = toast.variant === "success" ? "bg-emerald-600" : toast.variant === "error" ? "bg-rose-600" : "bg-slate-900";
        if (!toast.show) return null;
        return (
          <div role="status" aria-live="polite" className={`${base} px-4 py-2 rounded-xl text-white shadow-xl ${color}`}>
            <div className="flex items-center gap-3">
              <span className="text-sm">{toast.message}</span>
              <button onClick={onClose} className="text-xs bg-white/20 hover:bg-white/30 rounded px-2 py-1">닫기</button>
            </div>
          </div>
        );
      }

      // ====== 렌더링 (모든 선언 아래에서 호출해야 상단 컴포넌트가 필요한 상수들을 참조할 수 있습니다) ======
      const root = ReactDOM.createRoot(document.getElementById('root'));
      // 전역 노출(디버그용)
      window.HandoverPage = HandoverPage;
      root.render(<HandoverPage />);
    </script>
  </body>
</html>